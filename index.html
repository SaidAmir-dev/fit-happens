<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fit-Happens Virtual Fitting Room</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300..800;1,300..800&display=swap" rel="stylesheet">
    <style>
        /* Loading spinner */
        .loading-spinner {
            margin: 20px auto;
            width: 50px;
            height: 50px;
            border: 8px solid rgba(255, 255, 255, 0.3);
            border-top-color: black;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Styling for the arrow button */
        #refNumberInput button,
        #cameraPermission button,
        #container button {
            font-size: 1.5em;
            cursor: pointer;
            background-color: black;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        #refNumberInput button:hover,
        #cameraPermission button:hover,
        #container button:hover {
            background-color: #333;
        }

        /* Centered camera permission box */
        #cameraPermission {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 50%; /* Smaller width */
            margin: auto;
            padding: 20px;
            border: 2px solid black;
            border-radius: 10px;
            background-color: #f0f0f0;
            box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        /* Center the Take Photo button */
        #cameraPermission button {
            margin-top: 20px;
        }

        /* Main Content */
        #container {
            display: none;
            flex-direction: column;
            align-items: center;
        }

        /* Language Selector */
        #languageSelector {
            position: absolute;
            top: 20px;
            right: 20px;
            background-color: white;
            border: 1px solid black;
            border-radius: 5px;
            z-index: 10;
        }

        #languageSelector select {
            padding: 5px;
            font-size: 1em;
            appearance: none; /* Remove default styling */
        }

        .flag-option {
            display: flex;
            align-items: center;
        }

        .flag-option img {
            width: 20px; /* Adjust flag size */
            height: auto;
            margin-right: 8px; /* Spacing between flag and text */
        }
    </style>
</head>
<body>
    <!-- Language Selector -->
    <div id="languageSelector">
        <select onchange="changeLanguage(event)">
            <option value="en" class="flag-option">
                <img src="https://restcountries.com/data/usa.svg" alt="US Flag"> English
            </option>
            <option value="es" class="flag-option">
                <img src="https://restcountries.com/data/esp.svg" alt="Spain Flag"> Español
            </option>
            <option value="fr" class="flag-option">
                <img src="https://restcountries.com/data/fra.svg" alt="France Flag"> Français
            </option>
            <option value="zh" class="flag-option">
                <img src="https://restcountries.com/data/chn.svg" alt="China Flag"> 中文
            </option>
            <option value="pt" class="flag-option">
                <img src="https://restcountries.com/data/bra.svg" alt="Brazil Flag"> Português
            </option>
            <option value="ar" class="flag-option">
                <img src="https://restcountries.com/data/egy.svg" alt="Egypt Flag"> العربية
            </option>
            <option value="ru" class="flag-option">
                <img src="https://restcountries.com/data/rus.svg" alt="Russia Flag"> Русский
            </option>
            <option value="hi" class="flag-option">
                <img src="https://restcountries.com/data/ind.svg" alt="India Flag"> हिन्दी
            </option>
        </select>
    </div>

    <!-- Reference Number Entry -->
    <div id="refNumberInput">
        <h1 id="greeting">Hello!</h1>
        <label for="refNumber" id="refNumberLabel">Enter reference number:</label>
        <input type="text" id="refNumber" placeholder="0000" maxlength="4" pattern="\d{4}" required>
        <button onclick="startSession()">→</button>
    </div>

    <!-- Camera Permission and Face Capture -->
    <div id="cameraPermission" style="display: none;">
        <h2 id="faceScanTitle">Face Scan Required</h2>
        <p id="faceScanPrompt">Please position your face in front of the camera.</p>
        <video id="cameraFeed" autoplay playsinline></video>
        <button onclick="captureFace()" id="takePhotoButton">Take Photo</button>
    </div>

    <!-- Loading Screen -->
    <div id="loadingScreen" style="display: none;">
        <h2 id="loadingMessage">Please stand still, you are being scanned by LiDAR scanners...</h2>
        <div class="loading-spinner"></div>
    </div>

    <!-- Main Content -->
    <div id="container" style="display: none;">
        <!-- 3D Model Display Area -->
        <div id="model-view">
            <h2 id="modelTitle">Your 3D Model</h2>
            <div id="modelDisplay"> <!-- Placeholder for 3D model -->
                <p>[3D model will appear here]</p>
            </div>
            <button id="captureModelButton" onclick="capture3DModel()">Capture 3D Model</button>
        </div>

        <!-- Cart with Scanned Items -->
        <div id="cart-list">
            <h2 id="cartTitle">Your Scanned Items</h2>
            <div id="cartItems"> <!-- Placeholder for items list -->
                <p>No items scanned yet.</p>
            </div>
            <button id="finishSessionButton" onclick="finishSession()">Finish Session</button>
        </div>
    </div>

    <script>
        let videoStream;
        let currentLanguage = 'en'; // Default language

        // Language translations
        const translations = {
            en: {
                greeting: "Hello!",
                refNumberLabel: "Enter reference number:",
                faceScanTitle: "Face Scan Required",
                faceScanPrompt: "Please position your face in front of the camera.",
                loadingMessage: "Please stand still, you are being scanned by LiDAR scanners...",
                modelTitle: "Your 3D Model",
                cartTitle: "Your Scanned Items",
                captureModelButton: "Capture 3D Model",
                finishSessionButton: "Finish Session",
                takePhotoButton: "Take Photo",
                finishSessionMessage: "Thank you for using the Virtual Fitting Room! Your session is now complete."
            },
            es: {
                greeting: "¡Hola!",
                refNumberLabel: "Ingrese el número de referencia:",
                faceScanTitle: "Se requiere escaneo facial",
                faceScanPrompt: "Por favor, coloque su cara frente a la cámara.",
                loadingMessage: "Por favor, manténgase quieto, está siendo escaneado por escáneres LiDAR...",
                modelTitle: "Su modelo 3D",
                cartTitle: "Sus artículos escaneados",
                captureModelButton: "Capturar modelo 3D",
                finishSessionButton: "Finalizar sesión",
                takePhotoButton: "Tomar foto",
                finishSessionMessage: "¡Gracias por usar el probador virtual! Su sesión ha terminado."
            },
            fr: {
                greeting: "Bonjour!",
                refNumberLabel: "Entrez le numéro de référence :",
                faceScanTitle: "Scan du visage requis",
                faceScanPrompt: "Veuillez positionner votre visage devant la caméra.",
                loadingMessage: "Veuillez rester immobile, vous êtes scanné par des scanners LiDAR...",
                modelTitle: "Votre modèle 3D",
                cartTitle: "Vos articles scannés",
                captureModelButton: "Capturer le modèle 3D",
                finishSessionButton: "Terminer la session",
                takePhotoButton: "Prendre une photo",
                finishSessionMessage: "Merci d'avoir utilisé le cabines virtuelles ! Votre session est maintenant terminée."
            },
            zh: {
                greeting: "你好！",
                refNumberLabel: "请输入参考编号：",
                faceScanTitle: "需要面部扫描",
                faceScanPrompt: "请将您的面部放在相机前。",
                loadingMessage: "请保持静止，您正在被LiDAR扫描仪扫描...",
                modelTitle: "您的3D模型",
                cartTitle: "您扫描的商品",
                captureModelButton: "捕获3D模型",
                finishSessionButton: "完成会话",
                takePhotoButton: "拍照",
                finishSessionMessage: "感谢您使用虚拟试衣间！您的会话已完成。"
            },
            pt: {
                greeting: "Olá!",
                refNumberLabel: "Digite o número de referência:",
                faceScanTitle: "Escaneamento facial necessário",
                faceScanPrompt: "Por favor, posicione seu rosto na frente da câmera.",
                loadingMessage: "Por favor, fique parado, você está sendo escaneado por scanners LiDAR...",
                modelTitle: "Seu modelo 3D",
                cartTitle: "Seus itens escaneados",
                captureModelButton: "Capturar modelo 3D",
                finishSessionButton: "Finalizar sessão",
                takePhotoButton: "Tirar foto",
                finishSessionMessage: "Obrigado por usar o Vestiário Virtual! Sua sessão está agora completa."
            },
            ar: {
                greeting: "مرحبا!",
                refNumberLabel: "أدخل رقم المرجع:",
                faceScanTitle: "مسح الوجه مطلوب",
                faceScanPrompt: "يرجى وضع وجهك أمام الكاميرا.",
                loadingMessage: "يرجى الثبات، يتم مسحك بواسطة ماسحات ليزر ثلاثية الأبعاد...",
                modelTitle: "نموذجك ثلاثي الأبعاد",
                cartTitle: "عناصر المسح الخاصة بك",
                captureModelButton: "التقاط نموذج ثلاثي الأبعاد",
                finishSessionButton: "إنهاء الجلسة",
                takePhotoButton: "التقاط الصورة",
                finishSessionMessage: "شكرًا لاستخدامك غرفة القياس الافتراضية! تم الآن إنهاء جلستك."
            },
            ru: {
                greeting: "Здравствуйте!",
                refNumberLabel: "Введите номер ссылки:",
                faceScanTitle: "Необходим скан лица",
                faceScanPrompt: "Пожалуйста, расположите свое лицо перед камерой.",
                loadingMessage: "Пожалуйста, оставайтесь неподвижными, вас сканируют LiDAR-сканеры...",
                modelTitle: "Ваша 3D модель",
                cartTitle: "Ваши отсканированные предметы",
                captureModelButton: "Сохранить 3D модель",
                finishSessionButton: "Завершить сессию",
                takePhotoButton: "Сделать фото",
                finishSessionMessage: "Спасибо за использование виртуальной примерочной! Ваша сессия завершена."
            },
            hi: {
                greeting: "नमस्ते!",
                refNumberLabel: "संदर्भ संख्या दर्ज करें:",
                faceScanTitle: "चेहरे का स्कैन आवश्यक है",
                faceScanPrompt: "कृपया अपने चेहरे को कैमरे के सामने रखें।",
                loadingMessage: "कृपया स्थिर रहें, आपका LiDAR स्कैनर द्वारा स्कैन किया जा रहा है...",
                modelTitle: "आपका 3D मॉडल",
                cartTitle: "आपकी स्कैन की गई वस्तुएं",
                captureModelButton: "3D मॉडल कैप्चर करें",
                finishSessionButton: "सत्र समाप्त करें",
                takePhotoButton: "फोटो लें",
                finishSessionMessage: "वर्चुअल फिटिंग रूम का उपयोग करने के लिए धन्यवाद! आपका सत्र अब समाप्त हो गया है।"
            }
        };

        function changeLanguage(event) {
            currentLanguage = event.target.value;
            updateText();
        }

        function updateText() {
            document.getElementById("greeting").innerText = translations[currentLanguage].greeting;
            document.getElementById("refNumberLabel").innerText = translations[currentLanguage].refNumberLabel;
            document.getElementById("faceScanTitle").innerText = translations[currentLanguage].faceScanTitle;
            document.getElementById("faceScanPrompt").innerText = translations[currentLanguage].faceScanPrompt;
            document.getElementById("loadingMessage").innerText = translations[currentLanguage].loadingMessage;
            document.getElementById("modelTitle").innerText = translations[currentLanguage].modelTitle;
            document.getElementById("cartTitle").innerText = translations[currentLanguage].cartTitle;
            document.getElementById("captureModelButton").innerText = translations[currentLanguage].captureModelButton;
            document.getElementById("finishSessionButton").innerText = translations[currentLanguage].finishSessionButton;
            document.getElementById("takePhotoButton").innerText = translations[currentLanguage].takePhotoButton;
        }

        async function startSession() {
            const refNumber = document.getElementById('refNumber').value;
            if (refNumber.length === 4) {
                document.getElementById('refNumberInput').style.display = 'none';
                document.getElementById('cameraPermission').style.display = 'flex';
                await initializeCamera();
            } else {
                alert("Please enter a valid 4-digit reference number.");
            }
        }

        async function initializeCamera() {
            const constraints = {
                video: { facingMode: "user" }
            };
            try {
                videoStream = await navigator.mediaDevices.getUserMedia(constraints);
                document.getElementById('cameraFeed').srcObject = videoStream;
            } catch (error) {
                console.error("Error accessing the camera:", error);
                alert("Unable to access the camera. Please check your settings.");
            }
        }

        function captureFace() {
            // Capture face logic here
            document.getElementById('cameraPermission').style.display = 'none';
            document.getElementById('loadingScreen').style.display = 'block';

            // Simulate loading time before showing the model
            setTimeout(() => {
                document.getElementById('loadingScreen').style.display = 'none';
                document.getElementById('container').style.display = 'flex';
                // Show 3D model here
            }, 3000);
        }

        function capture3DModel() {
            // Capture 3D model logic here
            alert("3D Model captured!");
        }

        function finishSession() {
            // Finish session logic here
            alert(translations[currentLanguage].finishSessionMessage);
            // Reset the application or redirect
        }
    </script>
</body>
</html>
